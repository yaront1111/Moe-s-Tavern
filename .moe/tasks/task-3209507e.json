{
  "id": "task-3209507e",
  "epicId": "epic-a205c7a1",
  "title": "Add worker unblock mechanism and timeout",
  "description": "When a worker calls report_blocked, it's a dead-end. No tool exists to clear BLOCKED status. Human must manually intervene via plugin.\n\n**Add:**\n1. `moe.unblock_worker` tool - human/admin can clear blocked state with resolution info\n2. Auto-timeout: if worker blocked for >1 hour, auto-set to IDLE and log timeout event\n3. Worker can see its own blocked state via enhanced get_context (depends on task-f3b6132e)\n\n**New tool:**\n```typescript\nmoe.unblock_worker({\n  workerId: string,\n  resolution: string,     // what was done to unblock\n  retryTask?: boolean     // if true, worker should retry current task\n})\n```\n\n**Auto-timeout:** In daemon startup or periodic check, scan workers with status=BLOCKED and lastActivityAt older than threshold. Set to IDLE.\n\n**Key files:**\n- `packages/moe-daemon/src/tools/` - new tool\n- `packages/moe-daemon/src/state/StateManager.ts` - timeout logic\n- Plugin should also have an \"Unblock\" button in workers panel",
  "definitionOfDone": [
    "moe.unblock_worker tool exists and clears BLOCKED status",
    "Resolution reason logged to activity log",
    "Worker status set to IDLE after unblock",
    "Auto-timeout after configurable period (default 1 hour)",
    "Test added to tools.test.ts"
  ],
  "taskRails": [],
  "implementationPlan": [
    {
      "stepId": "step-1",
      "description": "Step 1: Create unblockWorker.ts tool in packages/moe-daemon/src/tools/. Accepts workerId (required), resolution (required string), retryTask (optional boolean, default false). Validates worker exists and is BLOCKED. Sets worker status to IDLE, clears lastError, stores resolution in activity log. If retryTask is true, keep currentTaskId so worker retries; otherwise clear it. Include error handling for missing worker and invalid state. Changes must not break existing agent scripts or MCP protocol.",
      "status": "COMPLETED",
      "affectedFiles": [
        "packages/moe-daemon/src/tools/unblockWorker.ts"
      ],
      "startedAt": "2026-02-06T22:27:07.674Z",
      "completedAt": "2026-02-06T22:28:03.324Z"
    },
    {
      "stepId": "step-2",
      "description": "Step 2: Register the new tool in tools/index.ts. Import unblockWorkerTool and add to getTools() array. Changes must not break existing agent scripts or MCP protocol.",
      "status": "COMPLETED",
      "affectedFiles": [
        "packages/moe-daemon/src/tools/index.ts"
      ],
      "startedAt": "2026-02-06T22:28:07.999Z",
      "completedAt": "2026-02-06T22:28:35.929Z"
    },
    {
      "stepId": "step-3",
      "description": "Step 3: Add auto-timeout logic to StateManager. On load() completion, scan all workers with status=BLOCKED and check if lastActivityAt is older than configurable threshold (default 3600000ms / 1 hour). If so, set status=IDLE, clear currentTaskId, log WORKER_TIMEOUT event to activity log. Also set task status back to BACKLOG if worker was assigned. Include error handling for missing timestamps. Run this check in a setInterval (every 5 minutes) that's cleared on shutdown.",
      "status": "COMPLETED",
      "affectedFiles": [
        "packages/moe-daemon/src/state/StateManager.ts"
      ],
      "startedAt": "2026-02-06T22:28:40.598Z",
      "completedAt": "2026-02-06T22:30:16.107Z"
    },
    {
      "stepId": "step-4",
      "description": "Step 4: Add test cases to tools.test.ts: (a) unblock_worker clears BLOCKED status to IDLE, (b) unblock_worker with retryTask=true keeps currentTaskId, (c) unblock_worker fails if worker not BLOCKED, (d) unblock_worker fails if worker doesn't exist, (e) resolution logged to activity. All new MCP tools must have tests in tools.test.ts.",
      "status": "COMPLETED",
      "affectedFiles": [
        "packages/moe-daemon/src/__tests__/tools.test.ts"
      ],
      "startedAt": "2026-02-06T22:30:20.935Z",
      "completedAt": "2026-02-06T22:33:09.044Z"
    }
  ],
  "status": "DONE",
  "assignedWorkerId": null,
  "branch": null,
  "prLink": null,
  "reopenCount": 0,
  "reopenReason": null,
  "createdBy": "WORKER",
  "parentTaskId": null,
  "priority": "MEDIUM",
  "order": 9,
  "createdAt": "2026-02-06T22:06:23.907Z",
  "updatedAt": "2026-02-06T22:34:12.094Z"
}